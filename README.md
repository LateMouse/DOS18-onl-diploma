## Выпускной проект TeachMeSlills
Курс: _DevOps инженер_ <br>
Группа: _DOS18-onl_ <br>
Студент: _Остриков Андрей Яковлевич_ <br>

### 0. Требования к дипломному проекту:
```markdown
ТРЕБОВАНИЯ К ДИПЛОМНОМУ ПРОЕКТУ

В дипломном проекте должно быть реализовано:
* выбран общедоступный репозиторий или несколько репозиториев с исходным кодом приложения,
состоящего из одного или нескольких микросервисов;
* выполнен fork или сделана копия репозитория;
* автоматизировано создание инфраструктуры для развертывания проекта;
* автоматизированы процессы CI/CD;
* настроен мониторинг инфраструктуры и приложения.

Критерии выполнения:
* Репозитории должен содержать минимальную документацию, описывающую
содержимое и процессы сборки и развертывания;
* Инфраструктура должна разворачиваться с нуля запуском одной команды.
Все должно быть реализовано по принципам IaC;
* CI/CD:
    o при коммите в любую ветку репозитория должны запускаться этапы проверки кода линтером, сборки исходного кода,
автотесты собранного приложения и загрузка артефактов в хранилище;
    o при коммите в основную ветку (master/main) дополнительно должен запускаться
автоматический deployment на целевую инфраструктуру;
    o Должно отправляться уведомление о результате сборки и развертывания в любой
канал (почта, чат).

Дополнительные (опциональные) варианты улучшения проекта:
* Реализация SSL/TLS;
* Масштабируемость (несколько реплик одного сервиса с балансировщиком);
* Контейнеризация;
* Kubernetes в качестве целевой инфраструктуры;
* Больше типов и количества тестов (интеграционное, нагрузочное и пр.);
* Автоматическая настройка всего (включая CI\CD, мониторинг) с нуля;
* Мониторинг инфраструктуры и приложения;
* Реализация Log-aggregation;
* Документированный код.

Применяемые инструменты:
* Развертывание инфраструктуры: Terraform, AWS, EKS, Ansible, Docker, Vagrant;
* CI/CD: Jenkins, Github Actions;
* Оповещение: Email, Telegram, Slack, Discord;
* Мониторинг: Prometheus, Grafana;
* Логирование: ELK.

Защита проекта:
* Краткая презентация с описанием проекта, примененными инструментами, проделанной работы
и полученными результатами (3-5 мин.);
* Демонстрация CI/CD (10-12 мин.);
* Вопросы и обсуждение (5-7 мин.).

Примеры репозиториев приложений:
* Golang Hello World
https://github.com/hackersandslackers/golang-helloworld
* Sample app maven
https://github.com/jenkins-docs/simple-java-maven-app
* Sample app gradle
https://github.com/jitpack/gradle-simple
https://github.com/jhipster/jhipster-sample-app-gradle
* Calculator App
https://github.com/HouariZegai/Calculator
```

### 1. Используемые инструменты:
- Docker
- Docker Compose
- Docker Hub
- Google Cloud Platform
- Google Kubernetis Engine
- Terraform
- GitHub
- GitHub Actions

### 2. Общее описание проекта:
Общая топология проекта: <br>
![Topologi](https://github.com/LateMouse/DOS18-onl-diploma/assets/114028634/f45ee7da-fc44-4127-b15e-44f5cc187ced) <br> <br>

Проект состоит из двух веток: main и dev. <br>
#### [Ветка dev]:
Ветка dev предназначена исключительно для проверки внесенных изменений и не влияет на активный проект. При коммите в ветку dev выполняются следующие шаги: <br> <br>

- Осуществляется проверка с использованием Linter конфигурационных файлов terraform, dockerfile и yaml.
- Устанавливаются необходимые инструменты для тестирования приложения, такие как terraform, Docker Compose и Google Cloud CLI.
- В директории, содержащей файлы terraform, инициализируются провайдеры и загружаются основные модули для создания инфраструктуры с помощью команды "terraform init".
- Осуществляется просмотр плана изменений, которые планируется применить Terraform к инфраструктуре с помощью команды "terraform plan".
- Создается Docker-образ на основе указанного в Dockerfile файла.
- С помощью Docker Compose запускается контейнер из созданного образа.
- Производится проверка путем отправки HTTP-запросов к контейнеру Docker. Если возвращаемый HTTP-код равен 200, проверка считается успешной.
- Контейнер останавливается, а Docker-образ удаляется.
- Создается Docker-образ на основе указанного в Dockerfile файла.
- Образ загружается в репозиторий Docker Hub.
- Выполняется предварительная проверка авторизации на Docker Hub для возможности загрузки образа в репозиторий.
- Отправляются уведомления в Telegram о новом коммите, внесенном в ветку.

<br>

#### [Ветка main]:
Ветка main имеет непосредственное влияние на активный процесс развертывания инфраструктуры в облачном провайдере и конфигурацию, а также на публикацию приложения в облаке. Запуск GitHub Actions происходит при коммите в основную ветку (main) или при слиянии (merge) dev ветки с основной. В процессе выполнения запуска GitHub Actions выполняются следующие шаги:

- Осуществляется проверка с использованием линтера для конфигурационных файлов terraform, dockerfile и yaml.
- Устанавливаются необходимые инструменты для тестирования приложения, такие как terraform, Docker Compose и Google Cloud CLI.
- В директории, содержащей файлы terraform, инициализируются провайдеры и загружаются основные модули для создания инфраструктуры с помощью команды "terraform init".
- Осуществляется просмотр плана изменений, которые планируется применить Terraform к инфраструктуре с помощью команды "terraform plan".
- Применяются изменения, описанные в Terraform-конфигурации, к инфраструктуре Google Cloud Platform с помощью команды "terraform apply".
- Создается Docker-образ на основе указанного в Dockerfile файла.
- С помощью Docker Compose запускается контейнер из созданного образа.
- Производится проверка путем отправки HTTP-запросов к контейнеру Docker. Если возвращаемый HTTP-код равен 200, проверка считается успешной.
- Контейнер останавливается, а Docker-образ удаляется.
- Устанавливается Google Kubernetes Engine Authentication Plugin для работы с кластером Kubernetes GKE.
- Устанавливается набор библиотек Google Cloud SDK для взаимодействия с облачной платформой.
- Проверяется подключение к кластеру Google Kubernetes Engine.
- Выполняется предварительная проверка авторизации на Docker Hub для возможности загрузки образа в репозиторий.
- Создается Docker-образ на основе указанного в Dockerfile файла.
- Образ загружается в репозиторий Docker Hub.
- Приложение разворачивается на основе образа, расположенного в репозитории Docker Hub, с использованием yaml-файла.
- Отправляются уведомления в Telegram о публикации приложения.

### 3. Предварительные условия для реализации проекта:

3.1 Наличие действующего проекта Google Cloud Platform <br> <br>

3.2 В проекте должны быть включены следующие API провайдера: <br>
- Kubernetes Engine API
- Compute Engine API
- Cloud Build API

3.3 Предварительно создан bucket для хранения файла состояния terraform <br> <br>

3.4 В проекте Google Cloud Platform создан service account с предварительно сгенерированным JSON–ключом и обладающим следующими привелегиями:
- Compute Storage Admin
- Kubernetes Engine Cluster Admin
- Kubernetes Engine Developer
- Storage Admin
- Storage Folder Admin
- Storage Object Admin

3.5 Созданный репозиторий в Docker Hub

3.6 Создание посредством BotFather бота для оповещений telegram

3.7 Наличие следующих секретов в GitHub:
- DOCKER_PASSWORD – токен доступа сгенерированный в Docker Hub
- DOCKER_USERNAME – имя учетной записи в Docker Hub
- GOOGLE_APPLICATION_CREDENTIALS – данне JSON-файла сервисного аккаунта Google Cloud Platform
- GOOGLE_CREDENTIALS – данне JSON-файла сервисного аккаунта Google Cloud Platform
- GOOGLE_PROJECT – ID проекта Google Cloud Platform
- TELEGRAM_CHAT_ID – ID группы Telegram
- TELEGRAM_TOKEN – токен созданный BotFather

### 4. Этапы выполнения проекта:

